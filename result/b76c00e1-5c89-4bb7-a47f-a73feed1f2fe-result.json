{"name": "上交所协商成交_正常撤单", "status": "failed", "statusDetails": {"message": "AssertionError: assert 2 == 9", "trace": "data = (2, '上交所固收（XSHG_FIX）', '协商成交（XSCJ_SHG）', '上交所协商成交_正常撤单', '上交所协商成交各接口各要素正确，撤单成功', 'critical', ...)\n\n    @pytest.mark.parametrize('data', read_excel('data/step_case.xlsx'))\n    def test_shg_fix(data):\n    \n        # 动态生成测试用例的feature、story、title、description、severity\n        if data[1] is not None:\n            allure.dynamic.feature(data[1])\n        if data[2] is not None:\n            allure.dynamic.story(data[2])\n        if data[3] is not None:\n            allure.dynamic.title(data[3])\n        if data[4] is not None:\n            allure.dynamic.description(data[4])\n        if data[5] is not None:\n            allure.dynamic.severity(data[5])\n        # 获取当前行数\n        row_num = data[0] + 1\n        try:\n            # 将从excel中读取的数据放入参数中\n            # 获取功能号单元格的数据数据\n            action_str = str(data[6])\n            # 获取需要读取的xml文件数据\n            xml_str = data[7]\n            # 获取需要重新设置的参数数据\n            param_str = data[8]\n            # 各个数据分别使用“;”分开，获取list\n            act_list = action_str.split(';')\n            xml_list = xml_str.split(';')\n            param_list = param_str.split(';')\n        except :\n            print('接口请求格式有误，请检查action、报文路径、参数')\n        # 对于每一行action有多个数据时，循环发送请求\n        for i in range(len(act_list)):\n            # 获取当前系统的时间\n            long_date, local_date, local_time = tools.get_system_time()\n            # 当前请求的参数设置\n            param_list_i = eval(param_list[i])\n    \n            # 将系统时间等信息设置到xml报文中,申报类的报文，默认将这些都添加到参数中\n            param_list_i['sendDateTime'] = long_date\n            param_list_i['ordDate'] = local_date\n            param_list_i['ordTime'] = local_time\n            param_list_i['actDate'] = local_date\n            param_list_i['actTime'] = local_time\n            param_list_i['orgOrdDate'] = local_date\n    \n            # 按照时间戳生成主键sysOrdID，并将该值存储在all_val，以便后续查询数字库，做断言使用\n            if 'sysOrdID' in param_list_i.keys():\n                sysord_id = str(int(time.time()))\n                param_list_i['sysOrdID'] = sysord_id\n                all_val['sysOrdID'] = sysord_id\n    \n            # 如果参数中有orgSysOrdID字段，则需要取出all_val中的sysOrdID值，对该笔报价进行撤单\n            if 'orgSysOrdID' in param_list_i.keys():\n                param_list_i['orgSysOrdID'] = all_val['sysOrdID']\n            # 获取了所有最新的需要修改的参数之后，调用工具函数将各个参数写入xml文件中\n            set_xml(xml_list[i], param_list_i)\n            data_xml = set_xml_string(xml_list[i])\n            # 发送请求\n            result = tools.send_post(act_list[i], data_xml)\n            time.sleep(3)\n    \n        if data[9] is not None and data[10] is not None and data[11] is not None:\n            # 查询数据库的基础sql\n            sql_str = data[9]\n            sql_str_list = sql_str.split(';')\n            for i in range(len(sql_str_list)):\n                # 数据库变量\n                sql_param_str = data[10]\n                # 将数据库变量用\";\"分隔\n                sql_param_list = sql_param_str.split(';')\n                # 存储经过转换后的数据库变量\n                param_list_num = []\n                # 获取列表长度\n                length = len(sql_param_list)\n                # 循环解析all_val[]值并填入list1\n                for j in range(length):\n                    param_list_num.append(eval(sql_param_list[j]))\n                sql = sql_str_list[i].format(*param_list_num)\n                hope_result = data[11]\n                hope_result_list = hope_result.split(';')\n                hope_result_dic_list =  []\n                for item in hope_result_list:\n                    temp_item = eval(item)\n                    hope_result_dic_list.append(temp_item)\n                    try:\n                        result_list = tools.oracle_link(sql)\n                    except :\n                        print('sql语句有误，请检查！！！')\n                for key in hope_result_dic_list[i].keys():\n                    with allure.step(f\"1、数据库{key}断言\"):\n                        with allure.step(f'预期结果：{key}={hope_result_dic_list[i][key]}'):\n                            real_result = result_list[key]\n                        with allure.step(f'实际结果：{key}={real_result}'):\n>                           assert real_result == hope_result_dic_list[i][key]\nE                           assert 2 == 9\n\ntestcase\\test_case_fix_excel.py:117: AssertionError"}, "description": "上交所协商成交各接口各要素正确，撤单成功", "steps": [{"name": "发送webservice请求", "status": "passed", "parameters": [{"name": "action", "value": "'1101'"}, {"name": "data", "value": "'<root>\n  <header>\n    <msgType>R</msgType>\n    <action>1101</action>\n    <clientID>xIR</clientID>\n    <reqSn>7897b7e19186472f823bad3d04ec9799</reqSn>\n    <sendDateTime>2023-06-25 15:08:10</sendDateTime>\n    <fromIPMAC>191.168.0.53,</fromIPMAC>\n  </header>\n  <body>\n    <orders>\n      <order>\n        <secuExtAccid>B883056635</secuExtAccid>\n        <orderType>9</orderType>\n        <dir>S</dir>\n        <iCode>010706</iCode>\n        <sysOrdID>1687676890</sysOrdID>\n        <iName>MDe5+tWuMDY=</iName>\n        <exeMarket>XSHG_FIX</exeMarket>\n        <ownerType>103</ownerType>\n        <bOrdCount>0</bOrdCount>\n        <bOrdPrice>0</bOrdPrice>\n        <sOrdCount>120</sOrdCount>\n        <sOrdPrice>102.889</sOrdPrice>\n        <settlType>103</settlType>\n        <settlPeriod />\n        <lastParPx>0</lastParPx>\n        <cashMargin>1</cashMargin>\n        <memo />\n        <ordDate>2023-06-25</ordDate>\n        <ordTime>15:08:10</ordTime>\n        <matchNo>512</matchNo>\n        <product>01</product>\n        <tradeType>10</tradeType>\n        <company>316</company>\n        <trader>Z31608</trader>\n        <seatno>88045</seatno>\n        <obTrader>Z31605</obTrader>\n        <iceCount>0</iceCount>\n        <clientOrdid>lwy111</clientOrdid>\n        <accname>lwy_shg_B883056635</accname>\n        <shareProperty>01</shareProperty>\n      </order>\n    </orders>\n    <accountInfo>\n      <cashExtAccID>lwy_wbzj_jys</cashExtAccID>\n      <cashExtAccName>lwy_shg_001</cashExtAccName>\n      <cashAccID>LWY_NBZJ_JYS</cashAccID>\n      <cashAccIDAccName>LWY_NBZJ_JYS</cashAccIDAccName>\n      <xirSecuExtAccID>lwy_wbzq_sh_02</xirSecuExtAccID>\n      <xirSecuExtAccName>lwy_wbzq_sh_02</xirSecuExtAccName>\n      <secuAccID>LWY_NBZQ_JYS</secuAccID>\n      <secuAccName>LWY_NBZQ_JYS</secuAccName>\n    </accountInfo>\n    <terminalInfo>\n      <clientPublicIpAddress />\n      <clientPublicPort />\n      <clientInnerIpAddress />\n      <clientMacaddress />\n      <clientHarddiskno />\n      <clientPcname />\n      <clientCpuno />\n      <clientDiskpartitioninfo />\n      <clientReellabel />\n      <clientName>xIRCS</clientName>\n      <clientVersion />\n      <isTerminalinfo>0</isTerminalinfo>\n    </terminalInfo>\n  </body>\n</root>'"}], "start": 1687676890337, "stop": 1687676890363}, {"name": "发送webservice请求", "status": "passed", "parameters": [{"name": "action", "value": "'1102'"}, {"name": "data", "value": "'<root>\n  <header>\n    <msgType>R</msgType>\n    <action>1102</action>\n    <clientID>xIR</clientID>\n    <reqSn>1b6bf9b933204547813ce42127872cbb</reqSn>\n    <sendDateTime>2023-06-25 15:08:13</sendDateTime>\n    <fromIPMAC>172.20.10.30,8C-16-45-9F-36-50</fromIPMAC>\n  </header>\n  <body>\n    <actions>\n    \t <action>\n\t        <actDate>2023-06-25</actDate>\n\t        <actTime>15:08:13</actTime>\n\t        <sysActID />\n\t        <actType>W</actType>\n\t        <orgOrdDate>2023-06-25</orgOrdDate>\n\t        <orgSysOrdID>1687676890</orgSysOrdID>\n\t        <extActID />\n\t        <userID />\n\t        <compID />\n         </action>\n    </actions>\n    <terminalInfo>\n      <clientPublicIpAddress />\n      <clientPublicPort />\n      <clientInnerIpAddress>127.0.0.1</clientInnerIpAddress>\n      <clientMacaddress>8C16459F3650^C0B6F9E3ABDA^C2B6F9E3ABD9^C0B6F9E3ABD9^00FF818789ED^00FFE575E6DC^00FF1F4140A5</clientMacaddress>\n      <clientHarddiskno>LSL7012818516F02116</clientHarddiskno>\n      <clientPcname>B1221</clientPcname>\n      <clientCpuno>BFEBFBFF000806E9</clientCpuno>\n      <clientDiskpartitioninfo>C^NTFS^119G</clientDiskpartitioninfo>\n      <clientReellabel>000B-1D29</clientReellabel>\n      <clientName>xIRCS</clientName>\n      <clientVersion>1.3.0.075_QUOTE_3</clientVersion>\n      <isTerminalinfo>1</isTerminalinfo>\n    </terminalInfo>\n  </body>\n</root>'"}], "start": 1687676893365, "stop": 1687676893392}, {"name": "连接数据查询", "status": "passed", "parameters": [{"name": "sql", "value": "'select t.ordstatus,t.act_status,t.acttype from ttrd_fix_order t where t.sysordid=1687676890'"}], "start": 1687676896393, "stop": 1687676896448}, {"name": "连接数据查询", "status": "passed", "parameters": [{"name": "sql", "value": "'select t.ordstatus,t.act_status,t.acttype from ttrd_fix_order t where t.sysordid=1687676890'"}], "start": 1687676896449, "stop": 1687676896577}, {"name": "1、数据库ORDSTATUS断言", "status": "failed", "statusDetails": {"message": "AssertionError: assert 2 == 9\n", "trace": "  File \"D:\\LWY-Other\\Git_project\\step_pytest_allure_codeing\\testcase\\test_case_fix_excel.py\", line 117, in test_shg_fix\n    assert real_result == hope_result_dic_list[i][key]\n"}, "steps": [{"name": "预期结果：ORDSTATUS=9", "status": "passed", "start": 1687676896577, "stop": 1687676896578}, {"name": "实际结果：ORDSTATUS=2", "status": "failed", "statusDetails": {"message": "AssertionError: assert 2 == 9\n", "trace": "  File \"D:\\LWY-Other\\Git_project\\step_pytest_allure_codeing\\testcase\\test_case_fix_excel.py\", line 117, in test_shg_fix\n    assert real_result == hope_result_dic_list[i][key]\n"}, "start": 1687676896578, "stop": 1687676896578}], "start": 1687676896577, "stop": 1687676896578}], "parameters": [{"name": "data", "value": "(2, '上交所固收（XSHG_FIX）', '协商成交（XSCJ_SHG）', '上交所协商成交_正常撤单', '上交所协商成交各接口各要素正确，撤单成功', 'critical', '1101;1102', 'data/shg_fix/DS_1101_SHG_Fix_XSCJ.xml;data/shg_fix/DS_1102_SHG_CD.xml', '{\"matchNo\":\"512\",\"sysOrdID\":\"\"};{\"orgSysOrdID\":\"\"}', 'select t.ordstatus,t.act_status,t.acttype from ttrd_fix_order t where t.sysordid={0};select t.actstatus,t.acttype from ttrd_fix_action t where t.o_sysordid={0}', 'all_val[\"sysOrdID\"]', '{\"ORDSTATUS\":9,\"ACT_STATUS\":\"6\",\"ACTTYPE\":\"W\"};{\"ACTSTATUS\":6,\"ACTTYPE\":\"W\"}', None)"}], "start": 1687676890333, "stop": 1687676896579, "uuid": "7804559c-8a0f-44da-8040-1b09bbb8c4ed", "historyId": "cf90e5bcdea4a435b5d4c0d3f4abc8fa", "testCaseId": "f6e2060948b5ee0332e39a62acbaca68", "fullName": "testcase.test_case_fix_excel#test_shg_fix", "labels": [{"name": "feature", "value": "上交所固收（XSHG_FIX）"}, {"name": "story", "value": "协商成交（XSCJ_SHG）"}, {"name": "severity", "value": "critical"}, {"name": "parentSuite", "value": "testcase"}, {"name": "suite", "value": "test_case_fix_excel"}, {"name": "host", "value": "HT-LPC-0297"}, {"name": "thread", "value": "30680-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "testcase.test_case_fix_excel"}]}